<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redis Langcache Demo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/operations-log.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="https://redis.com/wp-content/themes/wpx/assets/images/logo-redis.svg" alt="Redis Logo">
            <h1>LangCache Demo</h1>
        </div>
    </header>

    <div class="app-container">
        <!-- Top Pills Navigation -->
        <nav class="pills-nav">
            <div class="pills-container">
                <button class="pill-button active" data-pill="live-mode">Live Mode</button>
                <button class="pill-button" data-pill="shadow-mode">Shadow Mode</button>
                <button class="pill-button" data-pill="shadow-analysis">Shadow Analysis</button>
                <button class="pill-button" data-pill="settings">‚öôÔ∏è Settings</button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Live Mode Content -->
            <div class="pill-content active" id="live-mode-content">
                <div class="description">
                    <p>This demo shows the performance difference between using Redis Langcache vs. direct LLM queries.</p>
                </div>

                <div class="model-selection">
                    <div class="model-dropdown">
                        <label for="llm-model">LLM Model:</label>
                        <select id="llm-model">
                            <option value="gpt-4o-mini" selected>OpenAI GPT-4o-mini</option>
                            <option value="gpt-4o">OpenAI GPT-4o</option>
                            <option value="gpt-3.5-turbo">OpenAI GPT-3.5-turbo</option>
                            <option value="gemini-1.5-flash">Google Gemini Flash 1.5</option>
                        </select>
                    </div>
                    <div class="model-dropdown">
                        <label for="embedding-model">Embedding Model:</label>
                        <select id="embedding-model">
                            <option value="redis-langcache" selected>Redis: Langcache-Embed</option>
                            <option value="openai-text-embedding-small">OpenAI: text-embedding-small</option>
                            <option value="ollama-bge">Ollama: BGE-3</option>
                        </select>
                    </div>
                    <div class="threshold-input">
                        <label for="similarity-threshold">Similarity Threshold:</label>
                        <input type="number" id="similarity-threshold" min="0" max="1" step="0.01" value="0.85" placeholder="0.85">
                    </div>
                </div>

                <div class="query-section">
                    <div class="query-input">
                        <input type="text" id="query-input" placeholder="Enter your question here...">
                        <button id="submit-query">Ask</button>
                    </div>
                </div>

                <div class="panels-container">
                    <div class="panel cached">
                        <div class="panel-header">
                            <h3>Semantic Cache Panel</h3>
                            <div class="performance-indicator" style="display: none;">
                                <span class="response-time" id="cached-time"></span>
                            </div>
                        </div>
                        <div class="chat-container" id="cached-chat">
                            <div class="welcome-message">
                                <p><strong>‚úì Retrieved from Redis semantic cache</strong> will appear at the top when a cached response is found.</p>
                            </div>
                        </div>
                    </div>

                    <div class="panel standard">
                        <div class="panel-header">
                            <h3>Direct LLM Query</h3>
                            <div class="performance-indicator" style="display: none;">
                                <span class="response-time" id="standard-time"></span>
                            </div>
                        </div>
                        <div class="chat-container" id="standard-chat">
                            <div class="welcome-message">
                                <p><strong>Generated by LLM</strong> will always appear at the top, as this panel never uses the cache.</p>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

            <!-- Shadow Mode Content -->
            <div class="pill-content" id="shadow-mode-content">
                <div class="description">
                    <p>Shadow Mode: Cache performance is measured in the background while LLM responses are always shown to users.</p>
                </div>

                <div class="model-selection">
                    <div class="model-dropdown">
                        <label for="shadow-llm-model">LLM Model:</label>
                        <select id="shadow-llm-model">
                            <option value="gpt-4o-mini" selected>OpenAI GPT-4o-mini</option>
                            <option value="gpt-4o">OpenAI GPT-4o</option>
                            <option value="gpt-3.5-turbo">OpenAI GPT-3.5-turbo</option>
                            <option value="gemini-1.5-flash">Google Gemini Flash 1.5</option>
                        </select>
                    </div>
                    <div class="model-dropdown">
                        <label for="shadow-embedding-model">Embedding Model:</label>
                        <select id="shadow-embedding-model">
                            <option value="redis-langcache" selected>Redis: Langcache-Embed</option>
                            <option value="openai-text-embedding-small">OpenAI: text-embedding-small</option>
                            <option value="ollama-bge">Ollama: BGE-3</option>
                        </select>
                    </div>
                    <div class="threshold-input">
                        <label for="shadow-similarity-threshold">Similarity Threshold:</label>
                        <input type="number" id="shadow-similarity-threshold" min="0" max="1" step="0.01" value="0.85" placeholder="0.85">
                    </div>
                </div>

                <div class="query-section">
                    <div class="query-input">
                        <input type="text" id="shadow-query-input" placeholder="Enter your question here...">
                        <button id="shadow-ask-btn">Ask</button>
                    </div>
                </div>

                <div class="panels-container">
                    <div class="panel cached">
                        <div class="panel-header">
                            <h3>Semantic Cache Panel (Shadow Mode)</h3>
                            <div class="performance-indicator" style="display: none;">
                                <span class="response-time" id="shadow-cached-time"></span>
                            </div>
                        </div>
                        <div class="chat-container" id="shadow-cached-chat">
                            <div class="shadow-mode-notice" style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                                <strong>üîç Shadow Mode Active:</strong> No responses will be shown to users from LangCache. Only cache hit/miss status is recorded for analysis.
                            </div>
                            <div class="welcome-message">
                                <p><strong>Cache operations are measured in the background.</strong> Actual responses are always served from the Direct LLM panel.</p>
                            </div>
                        </div>
                    </div>

                    <div class="panel standard">
                        <div class="panel-header">
                            <h3>Direct LLM Query</h3>
                            <div class="performance-indicator" style="display: none;">
                                <span class="response-time" id="shadow-standard-time"></span>
                            </div>
                        </div>
                        <div class="chat-container" id="shadow-standard-chat">
                            <div class="welcome-message">
                                <p><strong>Generated by LLM</strong> will always appear at the top, as this panel never uses the cache.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shadow Analysis Content -->
            <div class="pill-content" id="shadow-analysis-content">
                <iframe src="/shadow-analysis"
                        style="width: 100%; height: 800px; border: none; border-radius: 8px;">
                </iframe>
            </div>

            <!-- Settings Content -->
            <div class="pill-content" id="settings-content">
                <div class="settings-container">
                    <h2>‚öôÔ∏è API Configuration</h2>
                    <p class="settings-description">Configure your API keys and Redis URL. These will be stored securely in your browser's local storage.</p>

                    <div class="settings-form">
                        <div class="setting-group">
                            <label for="openai-api-key">OpenAI API Key:</label>
                            <div class="input-with-toggle">
                                <input type="password" id="openai-api-key" placeholder="sk-..." />
                                <button type="button" class="toggle-visibility" data-target="openai-api-key">üëÅÔ∏è</button>
                            </div>
                            <small class="setting-help">Example: sk-proj-abc123... (Get your key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>)</small>
                        </div>

                        <div class="setting-group">
                            <label for="redis-url">Redis URL for LangCache Data:</label>
                            <div class="input-with-toggle">
                                <input type="password" id="redis-url" placeholder="redis://..." />
                                <button type="button" class="toggle-visibility" data-target="redis-url">üëÅÔ∏è</button>
                            </div>
                            <small class="setting-help">Example: redis://default:password@host:port (Your Redis Cloud or local Redis URL)</small>
                        </div>

                        <div class="settings-actions">
                            <button id="save-settings" class="save-btn">üíæ Save Settings</button>
                            <button id="test-settings" class="test-btn">üß™ Test Connection</button>
                            <button id="clear-settings" class="clear-btn">üóëÔ∏è Clear All</button>
                        </div>

                        <div class="settings-status" id="settings-status"></div>
                    </div>

                    <div class="settings-info">
                        <h3>üîí Security & Privacy</h3>
                        <ul>
                            <li>‚úÖ API keys are stored locally in your browser only</li>
                            <li>‚úÖ Keys are masked in the interface for security</li>
                            <li>‚úÖ Data is cleared when you close the browser</li>
                            <li>‚úÖ No keys are sent to our servers or stored permanently</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/latency.js') }}"></script>
    <script src="{{ url_for('static', filename='js/query-analysis.js') }}"></script>
    <script src="{{ url_for('static', filename='js/operations-log.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
    <script src="{{ url_for('static', filename='js/shadow-mode.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pills-navigation.js') }}"></script>
</body>
</html>
